# é…’åº—ç®¡ç†ç³»ç»Ÿ - å®‰å…¨æ€§è®¾è®¡è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [å®‰å…¨å¨èƒåˆ†æ](#å®‰å…¨å¨èƒåˆ†æ)
3. [èº«ä»½è®¤è¯ä¸æˆæƒ](#èº«ä»½è®¤è¯ä¸æˆæƒ)
4. [æ•°æ®å®‰å…¨é˜²æŠ¤](#æ•°æ®å®‰å…¨é˜²æŠ¤)
5. [è¾“å…¥éªŒè¯ä¸é˜²æŠ¤](#è¾“å…¥éªŒè¯ä¸é˜²æŠ¤)
6. [ä¼šè¯å®‰å…¨ç®¡ç†](#ä¼šè¯å®‰å…¨ç®¡ç†)
7. [æ—¥å¿—å®‰å…¨å®¡è®¡](#æ—¥å¿—å®‰å…¨å®¡è®¡)
8. [å®‰å…¨é…ç½®ä¸éƒ¨ç½²](#å®‰å…¨é…ç½®ä¸éƒ¨ç½²)

---

## ğŸ“– æ¦‚è¿°

æœ¬é…’åº—ç®¡ç†ç³»ç»Ÿé‡‡ç”¨å¤šå±‚å®‰å…¨é˜²æŠ¤æœºåˆ¶ï¼Œä»èº«ä»½è®¤è¯ã€æˆæƒæ§åˆ¶ã€æ•°æ®åŠ å¯†ã€è¾“å…¥éªŒè¯ã€ä¼šè¯ç®¡ç†åˆ°å®‰å…¨å®¡è®¡ï¼Œæ„å»ºäº†ä¸€ä¸ªå…¨é¢çš„å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼Œç¡®ä¿ç³»ç»Ÿå’Œæ•°æ®çš„å®‰å…¨æ€§ã€‚

### å®‰å…¨è®¾è®¡åŸåˆ™
- **æ·±åº¦é˜²å¾¡**ï¼šå¤šå±‚å®‰å…¨é˜²æŠ¤æœºåˆ¶
- **æœ€å°æƒé™åŸåˆ™**ï¼šç”¨æˆ·åªè·å¾—å¿…éœ€çš„æœ€ä½æƒé™
- **å®‰å…¨é»˜è®¤**ï¼šé»˜è®¤é…ç½®é‡‡ç”¨æœ€å®‰å…¨çš„é€‰é¡¹
- **ç®€å•æ€§**ï¼šå®‰å…¨æœºåˆ¶ç®€å•æ˜“æ‡‚ï¼Œå‡å°‘å‡ºé”™æ¦‚ç‡
- **å®¡è®¡è¿½è¸ª**ï¼šæ‰€æœ‰å®‰å…¨ç›¸å…³æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•

---

## ğŸš¨ å®‰å…¨å¨èƒåˆ†æ

### OWASP Top 10 å®‰å…¨é£é™©åº”å¯¹

```mermaid
graph TB
    subgraph "OWASP Top 10 å¨èƒ"
        A1[A1: æ³¨å…¥æ”»å‡»]
        A2[A2: èº«ä»½è®¤è¯å¤±æ•ˆ]
        A3[A3: æ•æ„Ÿæ•°æ®æ³„éœ²]
        A4[A4: XMLå¤–éƒ¨å®ä½“]
        A5[A5: è®¿é—®æ§åˆ¶å¤±æ•ˆ]
        A6[A6: å®‰å…¨é…ç½®é”™è¯¯]
        A7[A7: è·¨ç«™è„šæœ¬XSS]
        A8[A8: ä¸å®‰å…¨ååºåˆ—åŒ–]
        A9[A9: ç»„ä»¶æ¼æ´]
        A10[A10: æ—¥å¿—ç›‘æ§ä¸è¶³]
    end
    
    subgraph "é˜²æŠ¤æªæ–½"
        P1[PreparedStatementé˜²æ³¨å…¥]
        P2[ä¼šè¯ç®¡ç† + å¯†ç åŠ å¯†]
        P3[æ•æ„Ÿæ•°æ®åŠ å¯†]
        P4[è¾“å…¥éªŒè¯]
        P5[æƒé™æ§åˆ¶]
        P6[å®‰å…¨é…ç½®]
        P7[è¾“å‡ºç¼–ç  + CSP]
        P8[è¾“å…¥éªŒè¯]
        P9[ä¾èµ–ç®¡ç†]
        P10[å®‰å…¨å®¡è®¡æ—¥å¿—]
    end
    
    A1 --> P1
    A2 --> P2
    A3 --> P3
    A4 --> P4
    A5 --> P5
    A6 --> P6
    A7 --> P7
    A8 --> P8
    A9 --> P9
    A10 --> P10
```

### ç³»ç»Ÿé¢ä¸´çš„ä¸»è¦å¨èƒ

1. **SQLæ³¨å…¥æ”»å‡»**
   - æ¶æ„SQLä»£ç æ³¨å…¥
   - æ•°æ®åº“ä¿¡æ¯æ³„éœ²
   - æ•°æ®è¢«ç¯¡æ”¹æˆ–åˆ é™¤

2. **è·¨ç«™è„šæœ¬æ”»å‡»(XSS)**
   - æ¶æ„è„šæœ¬æ³¨å…¥
   - ç”¨æˆ·ä¿¡æ¯çªƒå–
   - ä¼šè¯åŠ«æŒ

3. **è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)**
   - ä¼ªé€ ç”¨æˆ·è¯·æ±‚
   - æœªæˆæƒæ“ä½œæ‰§è¡Œ

4. **èº«ä»½è®¤è¯ç»•è¿‡**
   - å¼±å¯†ç æ”»å‡»
   - ä¼šè¯åŠ«æŒ
   - è®¤è¯æœºåˆ¶ç¼ºé™·

5. **æ•æ„Ÿä¿¡æ¯æ³„éœ²**
   - æ•°æ®åº“è¿æ¥ä¿¡æ¯
   - ç”¨æˆ·å¯†ç æ˜æ–‡
   - ä¸ªäººéšç§æ•°æ®

---

## ğŸ” èº«ä»½è®¤è¯ä¸æˆæƒ

### 1. å¯†ç å®‰å…¨ç­–ç•¥

#### å¯†ç åŠ å¯†å®ç°
```java
public class PasswordUtil {
    private static final String ALGORITHM = "MD5";
    private static final String CHARSET = "UTF-8";
    
    /**
     * å¯¹å¯†ç è¿›è¡ŒMD5åŠ å¯†
     * @param password åŸå§‹å¯†ç 
     * @return åŠ å¯†åçš„å¯†ç 
     */
    public static String encrypt(String password) {
        if (password == null || password.isEmpty()) {
            return null;
        }
        
        try {
            MessageDigest md = MessageDigest.getInstance(ALGORITHM);
            byte[] bytes = md.digest(password.getBytes(CHARSET));
            return bytesToHex(bytes);
        } catch (Exception e) {
            throw new RuntimeException("å¯†ç åŠ å¯†å¤±è´¥", e);
        }
    }
    
    /**
     * éªŒè¯å¯†ç 
     * @param password åŸå§‹å¯†ç 
     * @param encryptedPassword åŠ å¯†åçš„å¯†ç 
     * @return å¯†ç æ­£ç¡®è¿”å›true
     */
    public static boolean verify(String password, String encryptedPassword) {
        if (password == null || encryptedPassword == null) {
            return false;
        }
        
        String encrypted = encrypt(password);
        return encrypted.equals(encryptedPassword);
    }
    
    /**
     * éªŒè¯å¯†ç å¼ºåº¦
     * @param password å¯†ç 
     * @return å¼ºåº¦ç­‰çº§ï¼ˆ1-5ï¼Œ5ä¸ºæœ€å¼ºï¼‰
     */
    public static int checkPasswordStrength(String password) {
        if (password == null || password.isEmpty()) {
            return 0;
        }
        
        boolean hasLower = password.matches(".*[a-z].*");
        boolean hasUpper = password.matches(".*[A-Z].*");
        boolean hasDigit = password.matches(".*[0-9].*");
        boolean hasSpecial = password.matches(".*[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?].*");
        
        int score = 1; // åŸºç¡€åˆ†æ•°
        
        // é•¿åº¦å¥–åŠ±
        if (password.length() >= 8) score++;
        if (password.length() >= 12) score++;
        
        // å­—ç¬¦ç±»å‹å¥–åŠ±
        if (hasUpper) score++;
        if (hasDigit) score++;
        if (hasSpecial) score++;
        
        return Math.min(score, 5);
    }
}
```

#### ç”¨æˆ·è®¤è¯æµç¨‹
```java
public class AuthenticationService {
    private static final Logger logger = LogManager.getLogger(AuthenticationService.class);
    private UserDAO userDAO;
    
    public AuthenticationService() {
        this.userDAO = DAOFactory.getUserDAO();
    }
    
    /**
     * ç”¨æˆ·ç™»å½•éªŒè¯
     * @param username ç”¨æˆ·å
     * @param password å¯†ç 
     * @return ç™»å½•æˆåŠŸè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œå¤±è´¥è¿”å›null
     */
    public User authenticate(String username, String password) {
        try {
            // 1. å‚æ•°éªŒè¯
            if (Utils.isEmpty(username) || Utils.isEmpty(password)) {
                logger.warn("ç™»å½•å¤±è´¥ï¼šç”¨æˆ·åæˆ–å¯†ç ä¸ºç©º");
                return null;
            }
            
            // 2. æŸ¥æ‰¾ç”¨æˆ·
            User user = userDAO.findByUsername(username.trim());
            if (user == null) {
                logger.warn("ç™»å½•å¤±è´¥ï¼šç”¨æˆ·ä¸å­˜åœ¨ï¼Œç”¨æˆ·å: {}", username);
                return null;
            }
            
            // 3. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
            if (user.getStatus() != UserStatus.ACTIVE) {
                logger.warn("ç™»å½•å¤±è´¥ï¼šç”¨æˆ·çŠ¶æ€å¼‚å¸¸ï¼Œç”¨æˆ·å: {}, çŠ¶æ€: {}", username, user.getStatus());
                return null;
            }
            
            // 4. éªŒè¯å¯†ç 
            if (!PasswordUtil.verify(password, user.getPassword())) {
                logger.warn("ç™»å½•å¤±è´¥ï¼šå¯†ç é”™è¯¯ï¼Œç”¨æˆ·å: {}", username);
                // è®°å½•ç™»å½•å¤±è´¥æ¬¡æ•°
                recordLoginFailure(user.getUserId());
                return null;
            }
            
            // 5. æ£€æŸ¥è´¦æˆ·æ˜¯å¦è¢«é”å®š
            if (isAccountLocked(user.getUserId())) {
                logger.warn("ç™»å½•å¤±è´¥ï¼šè´¦æˆ·è¢«é”å®šï¼Œç”¨æˆ·å: {}", username);
                return null;
            }
            
            // 6. ç™»å½•æˆåŠŸ
            logger.info("ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·å: {}", username);
            recordLoginSuccess(user.getUserId());
            
            return user;
            
        } catch (Exception e) {
            logger.error("ç”¨æˆ·è®¤è¯è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸", e);
            return null;
        }
    }
    
    /**
     * è®°å½•ç™»å½•å¤±è´¥
     */
    private void recordLoginFailure(Long userId) {
        // å®ç°ç™»å½•å¤±è´¥è®°å½•é€»è¾‘
        // å¯ä»¥è®°å½•åˆ°æ•°æ®åº“æˆ–ç¼“å­˜ä¸­
    }
    
    /**
     * è®°å½•ç™»å½•æˆåŠŸ
     */
    private void recordLoginSuccess(Long userId) {
        // æ¸…é™¤å¤±è´¥è®°å½•ï¼Œæ›´æ–°æœ€åç™»å½•æ—¶é—´
    }
    
    /**
     * æ£€æŸ¥è´¦æˆ·æ˜¯å¦è¢«é”å®š
     */
    private boolean isAccountLocked(Long userId) {
        // å®ç°è´¦æˆ·é”å®šæ£€æŸ¥é€»è¾‘
        // ä¾‹å¦‚ï¼šè¿ç»­å¤±è´¥3æ¬¡åé”å®š30åˆ†é’Ÿ
        return false;
    }
}
```

### 2. æƒé™æ§åˆ¶ç³»ç»Ÿ

#### åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)
```java
/**
 * ç”¨æˆ·è§’è‰²æšä¸¾
 */
public enum UserRole {
    ADMIN("ç®¡ç†å‘˜", Arrays.asList(
        Permission.USER_MANAGE, Permission.ROOM_MANAGE, 
        Permission.BOOKING_MANAGE, Permission.CUSTOMER_MANAGE,
        Permission.SYSTEM_CONFIG, Permission.AUDIT_LOG
    )),
    MANAGER("ç»ç†", Arrays.asList(
        Permission.ROOM_MANAGE, Permission.BOOKING_MANAGE, 
        Permission.CUSTOMER_MANAGE, Permission.REPORT_VIEW
    )),
    STAFF("å‘˜å·¥", Arrays.asList(
        Permission.BOOKING_MANAGE, Permission.CUSTOMER_MANAGE,
        Permission.ROOM_VIEW
    )),
    GUEST("è®¿å®¢", Arrays.asList(
        Permission.BOOKING_VIEW
    ));
    
    private final String displayName;
    private final List<Permission> permissions;
    
    UserRole(String displayName, List<Permission> permissions) {
        this.displayName = displayName;
        this.permissions = permissions;
    }
    
    public boolean hasPermission(Permission permission) {
        return permissions.contains(permission);
    }
}

/**
 * æƒé™æšä¸¾
 */
public enum Permission {
    // ç”¨æˆ·ç®¡ç†æƒé™
    USER_MANAGE("ç”¨æˆ·ç®¡ç†"),
    USER_VIEW("ç”¨æˆ·æŸ¥çœ‹"),
    
    // æˆ¿é—´ç®¡ç†æƒé™
    ROOM_MANAGE("æˆ¿é—´ç®¡ç†"),
    ROOM_VIEW("æˆ¿é—´æŸ¥çœ‹"),
    
    // é¢„è®¢ç®¡ç†æƒé™
    BOOKING_MANAGE("é¢„è®¢ç®¡ç†"),
    BOOKING_VIEW("é¢„è®¢æŸ¥çœ‹"),
    
    // å®¢æˆ·ç®¡ç†æƒé™
    CUSTOMER_MANAGE("å®¢æˆ·ç®¡ç†"),
    CUSTOMER_VIEW("å®¢æˆ·æŸ¥çœ‹"),
    
    // ç³»ç»Ÿæƒé™
    SYSTEM_CONFIG("ç³»ç»Ÿé…ç½®"),
    AUDIT_LOG("å®¡è®¡æ—¥å¿—"),
    REPORT_VIEW("æŠ¥è¡¨æŸ¥çœ‹");
    
    private final String displayName;
    
    Permission(String displayName) {
        this.displayName = displayName;
    }
}
```

#### æƒé™éªŒè¯æ‹¦æˆªå™¨
```java
/**
 * æƒé™éªŒè¯æ³¨è§£
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    Permission value();
}

/**
 * æƒé™éªŒè¯æœåŠ¡
 */
public class AuthorizationService {
    private static final Logger logger = LogManager.getLogger(AuthorizationService.class);
    
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šæƒé™
     * @param user ç”¨æˆ·
     * @param permission æƒé™
     * @return æœ‰æƒé™è¿”å›true
     */
    public boolean hasPermission(User user, Permission permission) {
        if (user == null || permission == null) {
            return false;
        }
        
        UserRole role = user.getRole();
        boolean hasPermission = role.hasPermission(permission);
        
        logger.debug("æƒé™æ£€æŸ¥ - ç”¨æˆ·: {}, è§’è‰²: {}, æƒé™: {}, ç»“æœ: {}", 
                    user.getUsername(), role, permission, hasPermission);
        
        return hasPermission;
    }
    
    /**
     * éªŒè¯ç”¨æˆ·æƒé™ï¼Œæ— æƒé™æ—¶æŠ›å‡ºå¼‚å¸¸
     * @param user ç”¨æˆ·
     * @param permission æƒé™
     * @throws SecurityException æ— æƒé™æ—¶æŠ›å‡º
     */
    public void checkPermission(User user, Permission permission) throws SecurityException {
        if (!hasPermission(user, permission)) {
            logger.warn("æƒé™éªŒè¯å¤±è´¥ - ç”¨æˆ·: {}, æƒé™: {}", 
                       user != null ? user.getUsername() : "null", permission);
            throw new SecurityException("æƒé™ä¸è¶³ï¼š" + permission.getDisplayName());
        }
    }
}
```

---

## ğŸ›¡ï¸ æ•°æ®å®‰å…¨é˜²æŠ¤

### 1. SQLæ³¨å…¥é˜²æŠ¤

#### PreparedStatementä½¿ç”¨
```java
public class UserDAOImpl implements UserDAO {
    
    /**
     * é˜²SQLæ³¨å…¥çš„ç”¨æˆ·æŸ¥è¯¢
     * @param username ç”¨æˆ·å
     * @return ç”¨æˆ·ä¿¡æ¯
     */
    @Override
    public User findByUsername(String username) {
        // ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
        String sql = "SELECT * FROM users WHERE username = ? AND status = 'ACTIVE'";
        
        try (Connection conn = connectionPool.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            // è®¾ç½®å‚æ•°ï¼Œè‡ªåŠ¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
            stmt.setString(1, username);
            
            try (ResultSet rs = stmt.executeQuery()) {
                if (rs.next()) {
                    return mapResultSetToUser(rs);
                }
            }
            
        } catch (SQLException e) {
            logger.error("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥", e);
        }
        
        return null;
    }
    
    /**
     * å±é™©ç¤ºä¾‹ï¼šæ˜“å—SQLæ³¨å…¥æ”»å‡»ï¼ˆå·²é¿å…ï¼‰
     * String sql = "SELECT * FROM users WHERE username = '" + username + "'";
     * æ”»å‡»ç¤ºä¾‹ï¼šusername = "admin'; DROP TABLE users; --"
     */
}
```

#### è¾“å…¥éªŒè¯ä¸è¿‡æ»¤
```java
public class InputValidator {
    
    // SQLæ³¨å…¥æ£€æµ‹æ¨¡å¼
    private static final Pattern SQL_INJECTION_PATTERN = Pattern.compile(
        "(?i)\\b(union|select|insert|update|delete|drop|create|alter|exec|execute|script|javascript|vbscript)\\b"
    );
    
    /**
     * æ£€æµ‹æ˜¯å¦åŒ…å«SQLæ³¨å…¥æ”»å‡»
     * @param input è¾“å…¥å†…å®¹
     * @return åŒ…å«æ”»å‡»ä»£ç è¿”å›true
     */
    public static boolean containsSQLInjection(String input) {
        if (input == null) {
            return false;
        }
        
        return SQL_INJECTION_PATTERN.matcher(input).find();
    }
    
    /**
     * æ¸…ç†å±é™©å­—ç¬¦
     * @param input è¾“å…¥å†…å®¹
     * @return æ¸…ç†åçš„å†…å®¹
     */
    public static String sanitizeInput(String input) {
        if (input == null) {
            return null;
        }
        
        // ç§»é™¤æˆ–è½¬ä¹‰å±é™©å­—ç¬¦
        return input.replaceAll("[<>\"'%;()&+]", "")
                   .replaceAll("--", "")
                   .replaceAll("/\\*", "")
                   .replaceAll("\\*/", "");
    }
    
    /**
     * éªŒè¯è¾“å…¥å®‰å…¨æ€§
     * @param input è¾“å…¥å†…å®¹
     * @param fieldName å­—æ®µåç§°
     * @throws SecurityException è¾“å…¥ä¸å®‰å…¨æ—¶æŠ›å‡º
     */
    public static void validateInput(String input, String fieldName) throws SecurityException {
        if (input != null && containsSQLInjection(input)) {
            throw new SecurityException("è¾“å…¥å†…å®¹åŒ…å«å±é™©å­—ç¬¦ï¼š" + fieldName);
        }
    }
}
```

### 2. æ•æ„Ÿæ•°æ®ä¿æŠ¤

#### æ•°æ®åŠ å¯†å·¥å…·
```java
public class EncryptionUtil {
    private static final String AES_ALGORITHM = "AES";
    private static final String AES_TRANSFORMATION = "AES/CBC/PKCS5Padding";
    private static final String SECRET_KEY = "MySecretKey12345"; // åº”ä»é…ç½®æ–‡ä»¶è¯»å–
    
    /**
     * AESåŠ å¯†
     * @param plainText æ˜æ–‡
     * @return åŠ å¯†åçš„å¯†æ–‡
     */
    public static String encrypt(String plainText) {
        try {
            SecretKeySpec keySpec = new SecretKeySpec(SECRET_KEY.getBytes(), AES_ALGORITHM);
            Cipher cipher = Cipher.getInstance(AES_TRANSFORMATION);
            cipher.init(Cipher.ENCRYPT_MODE, keySpec);
            
            byte[] encrypted = cipher.doFinal(plainText.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
            
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }
    
    /**
     * AESè§£å¯†
     * @param cipherText å¯†æ–‡
     * @return è§£å¯†åçš„æ˜æ–‡
     */
    public static String decrypt(String cipherText) {
        try {
            SecretKeySpec keySpec = new SecretKeySpec(SECRET_KEY.getBytes(), AES_ALGORITHM);
            Cipher cipher = Cipher.getInstance(AES_TRANSFORMATION);
            cipher.init(Cipher.DECRYPT_MODE, keySpec);
            
            byte[] decrypted = cipher.doFinal(Base64.getDecoder().decode(cipherText));
            return new String(decrypted);
            
        } catch (Exception e) {
            throw new RuntimeException("è§£å¯†å¤±è´¥", e);
        }
    }
}

/**
 * æ•æ„Ÿæ•°æ®å¤„ç†æœåŠ¡
 */
public class SensitiveDataService {
    
    /**
     * ä¿å­˜æ•æ„Ÿå®¢æˆ·ä¿¡æ¯
     * @param customer å®¢æˆ·ä¿¡æ¯
     */
    public void saveSensitiveCustomerData(Customer customer) {
        try {
            // åŠ å¯†æ•æ„Ÿä¿¡æ¯
            if (customer.getIdCard() != null) {
                String encryptedIdCard = EncryptionUtil.encrypt(customer.getIdCard());
                customer.setIdCard(encryptedIdCard);
            }
            
            if (customer.getPhone() != null) {
                String encryptedPhone = EncryptionUtil.encrypt(customer.getPhone());
                customer.setPhone(encryptedPhone);
            }
            
            // ä¿å­˜åˆ°æ•°æ®åº“
            CustomerDAO customerDAO = DAOFactory.getCustomerDAO();
            customerDAO.save(customer);
            
        } catch (Exception e) {
            logger.error("ä¿å­˜æ•æ„Ÿå®¢æˆ·æ•°æ®å¤±è´¥", e);
            throw new RuntimeException("æ•°æ®ä¿å­˜å¤±è´¥");
        }
    }
    
    /**
     * è·å–æ•æ„Ÿå®¢æˆ·ä¿¡æ¯
     * @param customerId å®¢æˆ·ID
     * @return è§£å¯†åçš„å®¢æˆ·ä¿¡æ¯
     */
    public Customer getSensitiveCustomerData(Long customerId) {
        try {
            CustomerDAO customerDAO = DAOFactory.getCustomerDAO();
            Customer customer = customerDAO.findById(customerId);
            
            if (customer != null) {
                // è§£å¯†æ•æ„Ÿä¿¡æ¯
                if (customer.getIdCard() != null) {
                    String decryptedIdCard = EncryptionUtil.decrypt(customer.getIdCard());
                    customer.setIdCard(decryptedIdCard);
                }
                
                if (customer.getPhone() != null) {
                    String decryptedPhone = EncryptionUtil.decrypt(customer.getPhone());
                    customer.setPhone(decryptedPhone);
                }
            }
            
            return customer;
            
        } catch (Exception e) {
            logger.error("è·å–æ•æ„Ÿå®¢æˆ·æ•°æ®å¤±è´¥", e);
            throw new RuntimeException("æ•°æ®è·å–å¤±è´¥");
        }
    }
}
```

---

## ğŸ” è¾“å…¥éªŒè¯ä¸é˜²æŠ¤

### 1. XSSé˜²æŠ¤

#### è¾“å‡ºç¼–ç é˜²æŠ¤
```java
public class XSSProtectionUtil {
    
    /**
     * HTMLç¼–ç ï¼Œé˜²æ­¢XSSæ”»å‡»
     * @param input è¾“å…¥å†…å®¹
     * @return ç¼–ç åçš„å†…å®¹
     */
    public static String encodeHTML(String input) {
        if (input == null) {
            return null;
        }
        
        return input.replace("&", "&amp;")
                   .replace("<", "&lt;")
                   .replace(">", "&gt;")
                   .replace("\"", "&quot;")
                   .replace("'", "&#x27;")
                   .replace("/", "&#x2F;");
    }
    
    /**
     * JavaScriptç¼–ç 
     * @param input è¾“å…¥å†…å®¹
     * @return ç¼–ç åçš„å†…å®¹
     */
    public static String encodeJavaScript(String input) {
        if (input == null) {
            return null;
        }
        
        return input.replace("\\", "\\\\")
                   .replace("\"", "\\\"")
                   .replace("'", "\\'")
                   .replace("\n", "\\n")
                   .replace("\r", "\\r")
                   .replace("\t", "\\t");
    }
    
    /**
     * ç§»é™¤å±é™©çš„HTMLæ ‡ç­¾
     * @param input è¾“å…¥å†…å®¹
     * @return æ¸…ç†åçš„å†…å®¹
     */
    public static String sanitizeHTML(String input) {
        if (input == null) {
            return null;
        }
        
        // ç§»é™¤å±é™©æ ‡ç­¾
        return input.replaceAll("(?i)<script[^>]*>.*?</script>", "")
                   .replaceAll("(?i)<iframe[^>]*>.*?</iframe>", "")
                   .replaceAll("(?i)<object[^>]*>.*?</object>", "")
                   .replaceAll("(?i)<embed[^>]*>.*?</embed>", "")
                   .replaceAll("(?i)javascript:", "")
                   .replaceAll("(?i)vbscript:", "")
                   .replaceAll("(?i)onload=", "")
                   .replaceAll("(?i)onerror=", "")
                   .replaceAll("(?i)onclick=", "");
    }
}
```

#### JSPé¡µé¢ä¸­çš„XSSé˜²æŠ¤
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<!-- æ­£ç¡®çš„è¾“å‡ºæ–¹å¼ï¼šä½¿ç”¨c:outæ ‡ç­¾è‡ªåŠ¨è½¬ä¹‰ -->
<td><c:out value="${customer.name}" escapeXml="true" /></td>

<!-- é”™è¯¯çš„è¾“å‡ºæ–¹å¼ï¼šç›´æ¥è¾“å‡ºå¯èƒ½å¯¼è‡´XSS -->
<!-- <td>${customer.name}</td> -->

<!-- åœ¨JavaScriptä¸­è¾“å‡ºæ•°æ® -->
<script>
    // æ­£ç¡®æ–¹å¼ï¼šæœåŠ¡ç«¯ç¼–ç 
    var customerName = '<c:out value="${customer.name}" escapeXml="true" />';
    
    // é”™è¯¯æ–¹å¼ï¼šç›´æ¥è¾“å‡º
    // var customerName = '${customer.name}';
</script>
```

### 2. CSRFé˜²æŠ¤

#### CSRF Tokenç”Ÿæˆä¸éªŒè¯
```java
public class CSRFProtectionService {
    private static final String CSRF_TOKEN_ATTRIBUTE = "csrfToken";
    private static final int TOKEN_LENGTH = 32;
    
    /**
     * ç”ŸæˆCSRF Token
     * @param session HTTPä¼šè¯
     * @return CSRF Token
     */
    public static String generateCSRFToken(HttpSession session) {
        String token = generateRandomToken(TOKEN_LENGTH);
        session.setAttribute(CSRF_TOKEN_ATTRIBUTE, token);
        return token;
    }
    
    /**
     * éªŒè¯CSRF Token
     * @param request HTTPè¯·æ±‚
     * @return éªŒè¯é€šè¿‡è¿”å›true
     */
    public static boolean validateCSRFToken(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session == null) {
            return false;
        }
        
        String sessionToken = (String) session.getAttribute(CSRF_TOKEN_ATTRIBUTE);
        String requestToken = request.getParameter("csrfToken");
        
        return sessionToken != null && sessionToken.equals(requestToken);
    }
    
    /**
     * ç”ŸæˆéšæœºToken
     */
    private static String generateRandomToken(int length) {
        String chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        SecureRandom random = new SecureRandom();
        StringBuilder token = new StringBuilder();
        
        for (int i = 0; i < length; i++) {
            token.append(chars.charAt(random.nextInt(chars.length())));
        }
        
        return token.toString();
    }
}
```

#### CSRFé˜²æŠ¤è¿‡æ»¤å™¨
```java
public class CSRFProtectionFilter implements Filter {
    private static final Logger logger = LogManager.getLogger(CSRFProtectionFilter.class);
    
    // éœ€è¦CSRFä¿æŠ¤çš„æ–¹æ³•
    private static final Set<String> PROTECTED_METHODS = Set.of("POST", "PUT", "DELETE");
    
    // æ’é™¤çš„URLè·¯å¾„
    private static final Set<String> EXCLUDED_PATHS = Set.of("/login", "/logout");
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        String method = httpRequest.getMethod();
        String path = httpRequest.getServletPath();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦CSRFä¿æŠ¤
        if (PROTECTED_METHODS.contains(method) && !isExcludedPath(path)) {
            
            if (!CSRFProtectionService.validateCSRFToken(httpRequest)) {
                logger.warn("CSRF TokenéªŒè¯å¤±è´¥ - è·¯å¾„: {}, æ–¹æ³•: {}", path, method);
                
                httpResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);
                httpResponse.setContentType("application/json;charset=UTF-8");
                httpResponse.getWriter().write("{\"error\":\"CSRF TokenéªŒè¯å¤±è´¥\"}");
                return;
            }
        }
        
        chain.doFilter(request, response);
    }
    
    private boolean isExcludedPath(String path) {
        return EXCLUDED_PATHS.stream().anyMatch(path::startsWith);
    }
}
```

---

## ğŸ”’ ä¼šè¯å®‰å…¨ç®¡ç†

### 1. ä¼šè¯é…ç½®

#### ä¼šè¯è¶…æ—¶è®¾ç½®
```xml
<!-- web.xmlä¸­çš„ä¼šè¯é…ç½® -->
<session-config>
    <!-- ä¼šè¯è¶…æ—¶æ—¶é—´ï¼š30åˆ†é’Ÿ -->
    <session-timeout>30</session-timeout>
    
    <!-- Cookieé…ç½® -->
    <cookie-config>
        <!-- å¯ç”¨HttpOnlyï¼Œé˜²æ­¢XSSæ”»å‡»è·å–Cookie -->
        <http-only>true</http-only>
        <!-- å¯ç”¨Secureï¼Œåªåœ¨HTTPSä¸‹ä¼ è¾“Cookie -->
        <secure>true</secure>
        <!-- è®¾ç½®SameSiteå±æ€§ï¼Œé˜²æ­¢CSRFæ”»å‡» -->
        <same-site>Strict</same-site>
    </cookie-config>
</session-config>
```

#### ä¼šè¯ç®¡ç†æœåŠ¡
```java
public class SessionManager {
    private static final Logger logger = LogManager.getLogger(SessionManager.class);
    private static final int MAX_INACTIVE_INTERVAL = 30 * 60; // 30åˆ†é’Ÿ
    
    /**
     * åˆ›å»ºå®‰å…¨ä¼šè¯
     * @param request HTTPè¯·æ±‚
     * @param user ç”¨æˆ·ä¿¡æ¯
     */
    public static void createSecureSession(HttpServletRequest request, User user) {
        HttpSession session = request.getSession(true);
        
        // è®¾ç½®ä¼šè¯å±æ€§
        session.setAttribute("user", user);
        session.setAttribute("loginTime", new Date());
        session.setAttribute("lastAccessTime", new Date());
        
        // è®¾ç½®ä¼šè¯è¶…æ—¶
        session.setMaxInactiveInterval(MAX_INACTIVE_INTERVAL);
        
        // ç”ŸæˆCSRF Token
        String csrfToken = CSRFProtectionService.generateCSRFToken(session);
        session.setAttribute("csrfToken", csrfToken);
        
        logger.info("ç”¨æˆ·ä¼šè¯åˆ›å»ºæˆåŠŸ - ç”¨æˆ·: {}, ä¼šè¯ID: {}", 
                   user.getUsername(), session.getId());
    }
    
    /**
     * éªŒè¯ä¼šè¯æœ‰æ•ˆæ€§
     * @param request HTTPè¯·æ±‚
     * @return ä¼šè¯æœ‰æ•ˆè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œå¦åˆ™è¿”å›null
     */
    public static User validateSession(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session == null) {
            return null;
        }
        
        User user = (User) session.getAttribute("user");
        if (user == null) {
            return null;
        }
        
        // æ›´æ–°æœ€åè®¿é—®æ—¶é—´
        session.setAttribute("lastAccessTime", new Date());
        
        return user;
    }
    
    /**
     * é”€æ¯ä¼šè¯
     * @param request HTTPè¯·æ±‚
     */
    public static void destroySession(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            User user = (User) session.getAttribute("user");
            String username = user != null ? user.getUsername() : "unknown";
            
            session.invalidate();
            
            logger.info("ç”¨æˆ·ä¼šè¯é”€æ¯ - ç”¨æˆ·: {}", username);
        }
    }
    
    /**
     * æ£€æŸ¥ä¼šè¯æ˜¯å¦è¿‡æœŸ
     * @param session HTTPä¼šè¯
     * @return è¿‡æœŸè¿”å›true
     */
    public static boolean isSessionExpired(HttpSession session) {
        if (session == null) {
            return true;
        }
        
        Date lastAccessTime = (Date) session.getAttribute("lastAccessTime");
        if (lastAccessTime == null) {
            return true;
        }
        
        long inactiveTime = System.currentTimeMillis() - lastAccessTime.getTime();
        return inactiveTime > (MAX_INACTIVE_INTERVAL * 1000);
    }
}
```

### 2. ä¼šè¯åŠ«æŒé˜²æŠ¤

#### ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤
```java
public class SessionSecurityService {
    private static final Logger logger = LogManager.getLogger(SessionSecurityService.class);
    
    /**
     * é‡æ–°ç”Ÿæˆä¼šè¯IDï¼Œé˜²æ­¢ä¼šè¯å›ºå®šæ”»å‡»
     * @param request HTTPè¯·æ±‚
     */
    public static void regenerateSessionId(HttpServletRequest request) {
        HttpSession oldSession = request.getSession(false);
        if (oldSession != null) {
            
            // ä¿å­˜æ—§ä¼šè¯çš„å±æ€§
            Map<String, Object> attributes = new HashMap<>();
            Enumeration<String> attributeNames = oldSession.getAttributeNames();
            while (attributeNames.hasMoreElements()) {
                String name = attributeNames.nextElement();
                attributes.put(name, oldSession.getAttribute(name));
            }
            
            // ä½¿æ—§ä¼šè¯æ— æ•ˆ
            oldSession.invalidate();
            
            // åˆ›å»ºæ–°ä¼šè¯
            HttpSession newSession = request.getSession(true);
            
            // æ¢å¤ä¼šè¯å±æ€§
            for (Map.Entry<String, Object> entry : attributes.entrySet()) {
                newSession.setAttribute(entry.getKey(), entry.getValue());
            }
            
            logger.info("ä¼šè¯IDé‡æ–°ç”ŸæˆæˆåŠŸ");
        }
    }
    
    /**
     * æ£€æŸ¥ä¼šè¯æ¥æºIP
     * @param request HTTPè¯·æ±‚
     * @return IPä¸€è‡´è¿”å›true
     */
    public static boolean validateSessionIP(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session == null) {
            return false;
        }
        
        String sessionIP = (String) session.getAttribute("sessionIP");
        String currentIP = getClientIP(request);
        
        if (sessionIP == null) {
            // é¦–æ¬¡è®¿é—®ï¼Œè®°å½•IP
            session.setAttribute("sessionIP", currentIP);
            return true;
        }
        
        return sessionIP.equals(currentIP);
    }
    
    /**
     * è·å–å®¢æˆ·ç«¯çœŸå®IP
     */
    private static String getClientIP(HttpServletRequest request) {
        String ip = request.getHeader("X-Forwarded-For");
        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {
            ip = request.getHeader("Proxy-Client-IP");
        }
        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {
            ip = request.getHeader("WL-Proxy-Client-IP");
        }
        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {
            ip = request.getRemoteAddr();
        }
        return ip;
    }
}
```

---

## ğŸ“Š æ—¥å¿—å®‰å…¨å®¡è®¡

### 1. å®‰å…¨å®¡è®¡æ—¥å¿—

#### å®¡è®¡äº‹ä»¶å®šä¹‰
```java
public class AuditEvent {
    private String eventType;
    private String username;
    private String ipAddress;
    private String resource;
    private String action;
    private String result;
    private Date timestamp;
    private String details;
    
    // äº‹ä»¶ç±»å‹å¸¸é‡
    public static final String LOGIN_SUCCESS = "LOGIN_SUCCESS";
    public static final String LOGIN_FAILURE = "LOGIN_FAILURE";
    public static final String LOGOUT = "LOGOUT";
    public static final String ACCESS_DENIED = "ACCESS_DENIED";
    public static final String DATA_ACCESS = "DATA_ACCESS";
    public static final String DATA_MODIFY = "DATA_MODIFY";
    public static final String SECURITY_VIOLATION = "SECURITY_VIOLATION";
    
    // æ„é€ å‡½æ•°å’Œgetter/setteræ–¹æ³•...
}
```

#### å®¡è®¡æ—¥å¿—æœåŠ¡
```java
public class AuditLogService {
    private static final Logger auditLogger = LogManager.getLogger("AUDIT");
    private static final Logger logger = LogManager.getLogger(AuditLogService.class);
    
    /**
     * è®°å½•å®¡è®¡äº‹ä»¶
     * @param event å®¡è®¡äº‹ä»¶
     */
    public static void logAuditEvent(AuditEvent event) {
        try {
            // è®°å½•åˆ°å®¡è®¡æ—¥å¿—
            auditLogger.info("AUDIT|{}|{}|{}|{}|{}|{}|{}|{}", 
                event.getTimestamp(),
                event.getEventType(),
                event.getUsername(),
                event.getIpAddress(),
                event.getResource(),
                event.getAction(),
                event.getResult(),
                event.getDetails()
            );
            
            // å¯é€‰ï¼šå­˜å‚¨åˆ°æ•°æ®åº“
            saveAuditEventToDatabase(event);
            
        } catch (Exception e) {
            logger.error("è®°å½•å®¡è®¡æ—¥å¿—å¤±è´¥", e);
        }
    }
    
    /**
     * è®°å½•ç™»å½•æˆåŠŸäº‹ä»¶
     */
    public static void logLoginSuccess(String username, String ipAddress) {
        AuditEvent event = new AuditEvent();
        event.setEventType(AuditEvent.LOGIN_SUCCESS);
        event.setUsername(username);
        event.setIpAddress(ipAddress);
        event.setResource("SYSTEM");
        event.setAction("LOGIN");
        event.setResult("SUCCESS");
        event.setTimestamp(new Date());
        
        logAuditEvent(event);
    }
    
    /**
     * è®°å½•ç™»å½•å¤±è´¥äº‹ä»¶
     */
    public static void logLoginFailure(String username, String ipAddress, String reason) {
        AuditEvent event = new AuditEvent();
        event.setEventType(AuditEvent.LOGIN_FAILURE);
        event.setUsername(username);
        event.setIpAddress(ipAddress);
        event.setResource("SYSTEM");
        event.setAction("LOGIN");
        event.setResult("FAILURE");
        event.setDetails(reason);
        event.setTimestamp(new Date());
        
        logAuditEvent(event);
    }
    
    /**
     * è®°å½•æ•°æ®è®¿é—®äº‹ä»¶
     */
    public static void logDataAccess(String username, String ipAddress, 
                                   String resource, String action) {
        AuditEvent event = new AuditEvent();
        event.setEventType(AuditEvent.DATA_ACCESS);
        event.setUsername(username);
        event.setIpAddress(ipAddress);
        event.setResource(resource);
        event.setAction(action);
        event.setResult("SUCCESS");
        event.setTimestamp(new Date());
        
        logAuditEvent(event);
    }
    
    private static void saveAuditEventToDatabase(AuditEvent event) {
        // å®ç°æ•°æ®åº“å­˜å‚¨é€»è¾‘
    }
}
```

### 2. å®‰å…¨ç›‘æ§

#### å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
```java
public class SecurityMonitor {
    private static final Logger logger = LogManager.getLogger(SecurityMonitor.class);
    
    // ä½¿ç”¨ç¼“å­˜è®°å½•ç”¨æˆ·è¡Œä¸º
    private static final Map<String, UserBehavior> userBehaviorMap = new ConcurrentHashMap<>();
    
    /**
     * æ£€æµ‹å¼‚å¸¸ç™»å½•è¡Œä¸º
     * @param username ç”¨æˆ·å
     * @param ipAddress IPåœ°å€
     * @return æ£€æµ‹åˆ°å¼‚å¸¸è¿”å›true
     */
    public static boolean detectAbnormalLogin(String username, String ipAddress) {
        UserBehavior behavior = userBehaviorMap.computeIfAbsent(username, 
            k -> new UserBehavior());
        
        // æ£€æŸ¥ç™»å½•é¢‘ç‡
        if (behavior.isLoginTooFrequent()) {
            logger.warn("æ£€æµ‹åˆ°å¼‚å¸¸ç™»å½•é¢‘ç‡ - ç”¨æˆ·: {}, IP: {}", username, ipAddress);
            AuditLogService.logSecurityViolation(username, ipAddress, "å¼‚å¸¸ç™»å½•é¢‘ç‡");
            return true;
        }
        
        // æ£€æŸ¥IPåœ°å€å˜åŒ–
        if (behavior.hasIPChanged(ipAddress)) {
            logger.warn("æ£€æµ‹åˆ°IPåœ°å€å¼‚å¸¸å˜åŒ– - ç”¨æˆ·: {}, æ–°IP: {}, åŸIP: {}", 
                       username, ipAddress, behavior.getLastIP());
            AuditLogService.logSecurityViolation(username, ipAddress, "IPåœ°å€å¼‚å¸¸å˜åŒ–");
            return true;
        }
        
        // æ›´æ–°è¡Œä¸ºè®°å½•
        behavior.recordLogin(ipAddress);
        
        return false;
    }
    
    /**
     * æ£€æµ‹æ•°æ®è®¿é—®å¼‚å¸¸
     * @param username ç”¨æˆ·å
     * @param resource èµ„æº
     * @return æ£€æµ‹åˆ°å¼‚å¸¸è¿”å›true
     */
    public static boolean detectAbnormalDataAccess(String username, String resource) {
        UserBehavior behavior = userBehaviorMap.computeIfAbsent(username, 
            k -> new UserBehavior());
        
        // æ£€æŸ¥æ•°æ®è®¿é—®é¢‘ç‡
        if (behavior.isDataAccessTooFrequent(resource)) {
            logger.warn("æ£€æµ‹åˆ°å¼‚å¸¸æ•°æ®è®¿é—®é¢‘ç‡ - ç”¨æˆ·: {}, èµ„æº: {}", username, resource);
            AuditLogService.logSecurityViolation(username, "", "å¼‚å¸¸æ•°æ®è®¿é—®é¢‘ç‡");
            return true;
        }
        
        behavior.recordDataAccess(resource);
        return false;
    }
}

/**
 * ç”¨æˆ·è¡Œä¸ºè®°å½•
 */
class UserBehavior {
    private String lastIP;
    private Date lastLoginTime;
    private int loginCount;
    private Map<String, Integer> dataAccessCount;
    private Date lastResetTime;
    
    public UserBehavior() {
        this.dataAccessCount = new HashMap<>();
        this.lastResetTime = new Date();
    }
    
    public boolean isLoginTooFrequent() {
        // 1åˆ†é’Ÿå†…ç™»å½•è¶…è¿‡5æ¬¡è®¤ä¸ºå¼‚å¸¸
        if (lastLoginTime != null) {
            long timeDiff = System.currentTimeMillis() - lastLoginTime.getTime();
            if (timeDiff < 60000 && loginCount > 5) {
                return true;
            }
        }
        return false;
    }
    
    public boolean hasIPChanged(String currentIP) {
        return lastIP != null && !lastIP.equals(currentIP);
    }
    
    public void recordLogin(String ipAddress) {
        Date now = new Date();
        
        // é‡ç½®è®¡æ•°å™¨ï¼ˆæ¯å°æ—¶é‡ç½®ï¼‰
        if (lastResetTime == null || 
            (now.getTime() - lastResetTime.getTime()) > 3600000) {
            loginCount = 0;
            lastResetTime = now;
        }
        
        this.lastIP = ipAddress;
        this.lastLoginTime = now;
        this.loginCount++;
    }
    
    public boolean isDataAccessTooFrequent(String resource) {
        Integer count = dataAccessCount.getOrDefault(resource, 0);
        return count > 100; // 1å°æ—¶å†…è®¿é—®åŒä¸€èµ„æºè¶…è¿‡100æ¬¡
    }
    
    public void recordDataAccess(String resource) {
        Date now = new Date();
        
        // é‡ç½®è®¡æ•°å™¨ï¼ˆæ¯å°æ—¶é‡ç½®ï¼‰
        if (lastResetTime == null || 
            (now.getTime() - lastResetTime.getTime()) > 3600000) {
            dataAccessCount.clear();
            lastResetTime = now;
        }
        
        dataAccessCount.merge(resource, 1, Integer::sum);
    }
    
    // getteræ–¹æ³•...
}
```

---

## âš™ï¸ å®‰å…¨é…ç½®ä¸éƒ¨ç½²

### 1. åº”ç”¨æœåŠ¡å™¨å®‰å…¨é…ç½®

#### Tomcatå®‰å…¨é…ç½®
```xml
<!-- server.xmlå®‰å…¨é…ç½® -->
<Server port="8005" shutdown="SHUTDOWN">
    <!-- éšè—æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ -->
    <Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               server="Apache" />
    
    <!-- HTTPSé…ç½® -->
    <Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"
               maxThreads="150" SSLEnabled="true" scheme="https" secure="true"
               clientAuth="false" sslProtocol="TLS"
               keystoreFile="conf/keystore.jks"
               keystorePass="password" />
</Server>
```

#### web.xmlå®‰å…¨é…ç½®
```xml
<web-app>
    <!-- å®‰å…¨çº¦æŸ -->
    <security-constraint>
        <web-resource-collection>
            <web-resource-name>Admin Area</web-resource-name>
            <url-pattern>/admin/*</url-pattern>
        </web-resource-collection>
        <auth-constraint>
            <role-name>admin</role-name>
        </auth-constraint>
        <user-data-constraint>
            <transport-guarantee>CONFIDENTIAL</transport-guarantee>
        </user-data-constraint>
    </security-constraint>
    
    <!-- é”™è¯¯é¡µé¢é…ç½® -->
    <error-page>
        <error-code>404</error-code>
        <location>/error/404.jsp</location>
    </error-page>
    <error-page>
        <error-code>500</error-code>
        <location>/error/500.jsp</location>
    </error-page>
    
    <!-- HTTPå®‰å…¨å¤´ -->
    <filter>
        <filter-name>SecurityHeadersFilter</filter-name>
        <filter-class>com.hotel.filter.SecurityHeadersFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>SecurityHeadersFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
</web-app>
```

### 2. å®‰å…¨å“åº”å¤´è®¾ç½®

#### å®‰å…¨å¤´è¿‡æ»¤å™¨
```java
public class SecurityHeadersFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // X-Frame-Options: é˜²æ­¢ç‚¹å‡»åŠ«æŒ
        httpResponse.setHeader("X-Frame-Options", "DENY");
        
        // X-Content-Type-Options: é˜²æ­¢MIMEç±»å‹å—…æ¢
        httpResponse.setHeader("X-Content-Type-Options", "nosniff");
        
        // X-XSS-Protection: å¯ç”¨æµè§ˆå™¨XSSè¿‡æ»¤
        httpResponse.setHeader("X-XSS-Protection", "1; mode=block");
        
        // Strict-Transport-Security: å¼ºåˆ¶HTTPS
        httpResponse.setHeader("Strict-Transport-Security", 
                              "max-age=31536000; includeSubDomains");
        
        // Content-Security-Policy: å†…å®¹å®‰å…¨ç­–ç•¥
        httpResponse.setHeader("Content-Security-Policy", 
                              "default-src 'self'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' cdn.jsdelivr.net; font-src 'self' cdnjs.cloudflare.com");
        
        // Referrer-Policy: å¼•ç”¨ç­–ç•¥
        httpResponse.setHeader("Referrer-Policy", "strict-origin-when-cross-origin");
        
        // Permissions-Policy: æƒé™ç­–ç•¥
        httpResponse.setHeader("Permissions-Policy", 
                              "camera=(), microphone=(), geolocation=()");
        
        chain.doFilter(request, response);
    }
}
```

### 3. æ•°æ®åº“å®‰å…¨é…ç½®

#### æ•°æ®åº“è¿æ¥å®‰å…¨
```properties
# db.propertieså®‰å…¨é…ç½®

# æ•°æ®åº“è¿æ¥ï¼ˆä½¿ç”¨æœ€å°æƒé™è´¦æˆ·ï¼‰
db.username=hotel_app_user
db.password=encrypted_password

# è¿æ¥æ± å®‰å…¨é…ç½®
db.initialSize=5
db.maxActive=20
db.maxWait=60000
db.timeBetweenEvictionRunsMillis=60000
db.minEvictableIdleTimeMillis=300000

# è¿æ¥éªŒè¯
db.validationQuery=SELECT 1
db.testWhileIdle=true
db.testOnBorrow=false
db.testOnReturn=false

# SSLè¿æ¥
db.useSSL=true
db.requireSSL=true
db.verifyServerCertificate=true
```

---

## ğŸ”š æ€»ç»“

æœ¬é…’åº—ç®¡ç†ç³»ç»Ÿçš„å®‰å…¨è®¾è®¡æ¶µç›–äº†ä»è¾“å…¥éªŒè¯åˆ°è¾“å‡ºç¼–ç ã€ä»èº«ä»½è®¤è¯åˆ°æƒé™æ§åˆ¶ã€ä»æ•°æ®åŠ å¯†åˆ°å®‰å…¨å®¡è®¡çš„å…¨æ–¹ä½å®‰å…¨é˜²æŠ¤ï¼š

### å®‰å…¨é˜²æŠ¤ä½“ç³»
1. **èº«ä»½è®¤è¯å®‰å…¨**ï¼šå¯†ç åŠ å¯†ã€ä¼šè¯ç®¡ç†ã€ç™»å½•ä¿æŠ¤
2. **æˆæƒæ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€ç»†ç²’åº¦æƒé™éªŒè¯
3. **æ•°æ®å®‰å…¨**ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†ã€SQLæ³¨å…¥é˜²æŠ¤ã€XSSé˜²æŠ¤
4. **ä¼šè¯å®‰å…¨**ï¼šå®‰å…¨ä¼šè¯é…ç½®ã€ä¼šè¯åŠ«æŒé˜²æŠ¤ã€CSRFé˜²æŠ¤
5. **å®‰å…¨å®¡è®¡**ï¼šå…¨é¢çš„æ—¥å¿—è®°å½•ã€å¼‚å¸¸è¡Œä¸ºç›‘æ§ã€å®‰å…¨äº‹ä»¶è¿½è¸ª
6. **éƒ¨ç½²å®‰å…¨**ï¼šå®‰å…¨é…ç½®ã€å®‰å…¨å“åº”å¤´ã€æ•°æ®åº“å®‰å…¨

### å®‰å…¨è®¾è®¡ç‰¹ç‚¹
- **å¤šå±‚é˜²æŠ¤**ï¼šåœ¨å¤šä¸ªå±‚é¢è®¾ç½®å®‰å…¨é˜²æŠ¤æªæ–½
- **ä¸»åŠ¨é˜²å¾¡**ï¼šä¸ä»…è¢«åŠ¨é˜²æŠ¤ï¼Œè¿˜ä¸»åŠ¨ç›‘æµ‹å¼‚å¸¸è¡Œä¸º
- **å…¨é¢è¦†ç›–**ï¼šæ¶µç›–OWASP Top 10çš„ä¸»è¦å®‰å…¨é£é™©
- **å¯æ‰©å±•æ€§**ï¼šå®‰å…¨æœºåˆ¶è®¾è®¡çµæ´»ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤

é€šè¿‡è¿™äº›å®‰å…¨æªæ–½çš„å®æ–½ï¼Œç³»ç»Ÿèƒ½å¤Ÿæœ‰æ•ˆæŠµå¾¡å¸¸è§çš„ç½‘ç»œæ”»å‡»ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿèµ„æºçš„å®‰å…¨ã€‚