# é…’åº—ç®¡ç†ç³»ç»Ÿ - æµ‹è¯•è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æµ‹è¯•æ¶æ„](#æµ‹è¯•æ¶æ„)
3. [å•å…ƒæµ‹è¯•](#å•å…ƒæµ‹è¯•)
4. [é›†æˆæµ‹è¯•](#é›†æˆæµ‹è¯•)
5. [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)
6. [æµ‹è¯•å·¥å…·](#æµ‹è¯•å·¥å…·)

---

## ğŸ“– æ¦‚è¿°

æœ¬é…’åº—ç®¡ç†ç³»ç»Ÿé‡‡ç”¨å…¨é¢çš„æµ‹è¯•ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿè´¨é‡ã€ç¨³å®šæ€§å’Œå¯é æ€§ã€‚æµ‹è¯•è¦†ç›–ä»å•å…ƒæµ‹è¯•åˆ°é›†æˆæµ‹è¯•ï¼Œä»åŠŸèƒ½éªŒè¯åˆ°æ€§èƒ½ä¿éšœçš„å„ä¸ªå±‚é¢ã€‚

### æµ‹è¯•ç›®æ ‡
- **åŠŸèƒ½æ­£ç¡®æ€§**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½æŒ‰éœ€æ±‚æ­£ç¡®å®ç°
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šéªŒè¯ç³»ç»Ÿåœ¨å„ç§æƒ…å†µä¸‹çš„ç¨³å®šè¿è¡Œ
- **æ€§èƒ½ä¿éšœ**ï¼šç¡®ä¿ç³»ç»Ÿæ»¡è¶³æ€§èƒ½è¦æ±‚
- **å®‰å…¨æ€§éªŒè¯**ï¼šéªŒè¯å®‰å…¨æœºåˆ¶çš„æœ‰æ•ˆæ€§

### æµ‹è¯•é‡‘å­—å¡”
```mermaid
graph TB
    subgraph "æµ‹è¯•åˆ†å±‚"
        UI[UIæµ‹è¯• 10%<br/>ç«¯åˆ°ç«¯æµ‹è¯•]
        IT[é›†æˆæµ‹è¯• 20%<br/>ç»„ä»¶é—´äº¤äº’]
        UT[å•å…ƒæµ‹è¯• 70%<br/>ç‹¬ç«‹åŠŸèƒ½æ¨¡å—]
    end
    
    UT --> IT
    IT --> UI
```

---

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### æµ‹è¯•åˆ†å±‚è®¾è®¡

```mermaid
graph TB
    subgraph "Controllerå±‚æµ‹è¯•"
        Param[å‚æ•°éªŒè¯æµ‹è¯•]
        Auth[æƒé™éªŒè¯æµ‹è¯•]
        Response[å“åº”æ ¼å¼æµ‹è¯•]
    end
    
    subgraph "Serviceå±‚æµ‹è¯•"
        Business[ä¸šåŠ¡é€»è¾‘æµ‹è¯•]
        Strategy[ç­–ç•¥æ¨¡å¼æµ‹è¯•]
        Transaction[äº‹åŠ¡å¤„ç†æµ‹è¯•]
    end
    
    subgraph "DAOå±‚æµ‹è¯•"
        CRUD[CRUDæ“ä½œæµ‹è¯•]
        SQL[SQLæŸ¥è¯¢æµ‹è¯•]
        Connection[è¿æ¥æ± æµ‹è¯•]
    end
    
    subgraph "å·¥å…·ç±»æµ‹è¯•"
        Util[å·¥å…·æ–¹æ³•æµ‹è¯•]
        Security[å®‰å…¨åŠŸèƒ½æµ‹è¯•]
        Config[é…ç½®ç®¡ç†æµ‹è¯•]
    end
    
    Param --> Business
    Auth --> Strategy
    Response --> Transaction
    Business --> CRUD
    Strategy --> SQL
    Transaction --> Connection
    CRUD --> Util
    SQL --> Security
    Connection --> Config
```

### æµ‹è¯•åŸºç¡€è®¾æ–½

#### æµ‹è¯•åŸºç¡€ç±»
```java
/**
 * æµ‹è¯•åŸºç¡€ç±»
 */
public abstract class BaseTest {
    protected static final Logger logger = LogManager.getLogger();
    
    @BeforeClass
    public static void setUpClass() {
        System.setProperty("test.mode", "true");
        initTestDatabase();
    }
    
    @Before
    public void setUp() {
        logger.info("å¼€å§‹æ‰§è¡Œæµ‹è¯•æ–¹æ³•: {}", getTestMethodName());
    }
    
    @After
    public void tearDown() {
        logger.info("æµ‹è¯•æ–¹æ³•æ‰§è¡Œå®Œæˆ: {}", getTestMethodName());
    }
    
    protected String getTestMethodName() {
        StackTraceElement[] stackTrace = Thread.currentThread().getStackTrace();
        for (StackTraceElement element : stackTrace) {
            if (element.getMethodName().startsWith("test")) {
                return element.getMethodName();
            }
        }
        return "unknown";
    }
}
```

---

## ğŸ”¬ å•å…ƒæµ‹è¯•

### 1. å·¥å…·ç±»æµ‹è¯•

#### å¯†ç å·¥å…·æµ‹è¯•
```java
public class PasswordUtilTest extends BaseTest {
    
    @Test
    public void testEncrypt() {
        String password = "test123";
        String encrypted = PasswordUtil.encrypt(password);
        
        assertNotNull("åŠ å¯†ç»“æœä¸åº”è¯¥ä¸ºnull", encrypted);
        assertNotEquals("åŠ å¯†åçš„å¯†ç åº”è¯¥ä¸åŸå¯†ç ä¸åŒ", password, encrypted);
        assertEquals("ç›¸åŒå¯†ç åŠ å¯†ç»“æœåº”è¯¥ç›¸åŒ", encrypted, PasswordUtil.encrypt(password));
        assertEquals("MD5ç»“æœåº”è¯¥æ˜¯32ä½", 32, encrypted.length());
    }
    
    @Test
    public void testPasswordStrengthCheck() {
        assertEquals("ç©ºå¯†ç å¼ºåº¦åº”è¯¥ä¸º0", 0, PasswordUtil.checkPasswordStrength(""));
        assertEquals("çº¯å°å†™å¯†ç å¼ºåº¦è¾ƒä½", 1, PasswordUtil.checkPasswordStrength("password"));
        assertEquals("å¤æ‚å¯†ç å¼ºåº¦åº”è¯¥æœ€é«˜", 5, PasswordUtil.checkPasswordStrength("Password123!@#"));
    }
    
    @Test(expected = IllegalArgumentException.class)
    public void testGenerateRandomPasswordInvalidLength() {
        PasswordUtil.generateRandomPassword(3);
    }
}
```

#### è¿æ¥æ± æµ‹è¯•
```java
public class ConnectionPoolTest extends BaseTest {
    
    @Test
    public void testSingletonPattern() {
        ConnectionPool pool1 = ConnectionPool.getInstance();
        ConnectionPool pool2 = ConnectionPool.getInstance();
        assertSame("åº”è¯¥è¿”å›åŒä¸€ä¸ªå®ä¾‹", pool1, pool2);
    }
    
    @Test
    public void testGetConnection() {
        try (Connection connection = ConnectionPool.getInstance().getConnection()) {
            if (connection != null) {
                assertNotNull("è¿æ¥ä¸åº”è¯¥ä¸ºnull", connection);
                assertFalse("è¿æ¥åº”è¯¥æ˜¯æ‰“å¼€çš„", connection.isClosed());
                assertTrue("è¿æ¥åº”è¯¥æœ‰æ•ˆ", connection.isValid(5));
            }
        } catch (SQLException e) {
            logger.warn("æ•°æ®åº“è¿æ¥æµ‹è¯•å¤±è´¥: {}", e.getMessage());
        }
    }
}
```

### 2. ä¸šåŠ¡é€»è¾‘æµ‹è¯•

#### é¢„è®¢æœåŠ¡æµ‹è¯•
```java
public class BookingServiceTest extends BaseTest {
    
    private BookingService bookingService;
    
    @Before
    public void setUp() {
        super.setUp();
        bookingService = new BookingServiceImpl();
    }
    
    @Test
    public void testCreateBooking() {
        try {
            Booking booking = new Booking();
            booking.setCustomerId(1L);
            booking.setRoomId(1L);
            booking.setCheckInDate(Date.valueOf("2025-12-01"));
            booking.setCheckOutDate(Date.valueOf("2025-12-03"));
            booking.setGuestsCount(2);
            booking.setStatus(Booking.BookingStatus.PENDING);
            
            Integer bookingId = bookingService.createBooking(booking);
            assertNotNull("é¢„è®¢åˆ›å»ºåº”è¯¥æˆåŠŸ", bookingId);
            
            // éªŒè¯é¢„è®¢ä¿¡æ¯
            Booking created = bookingService.getBookingById(bookingId);
            assertNotNull("åº”è¯¥èƒ½æŸ¥è¯¢åˆ°åˆ›å»ºçš„é¢„è®¢", created);
            assertEquals("çŠ¶æ€åº”è¯¥æ­£ç¡®", Booking.BookingStatus.PENDING, created.getStatus());
            
            // æ¸…ç†æµ‹è¯•æ•°æ®
            bookingService.deleteBooking(bookingId);
            
        } catch (Exception e) {
            logger.error("é¢„è®¢åˆ›å»ºæµ‹è¯•å¤±è´¥", e);
        }
    }
    
    @Test
    public void testBookingStatusFlow() {
        try {
            Booking booking = createTestBooking();
            if (booking == null) return;
            
            Integer bookingId = booking.getBookingId();
            
            // ç¡®è®¤é¢„è®¢
            boolean confirmResult = bookingService.confirmBooking(bookingId);
            assertTrue("é¢„è®¢ç¡®è®¤åº”è¯¥æˆåŠŸ", confirmResult);
            
            // åŠç†å…¥ä½
            boolean checkInResult = bookingService.checkIn(bookingId);
            assertTrue("åŠç†å…¥ä½åº”è¯¥æˆåŠŸ", checkInResult);
            
            // åŠç†é€€æˆ¿
            boolean checkOutResult = bookingService.checkOut(bookingId);
            assertTrue("åŠç†é€€æˆ¿åº”è¯¥æˆåŠŸ", checkOutResult);
            
            bookingService.deleteBooking(bookingId);
            
        } catch (Exception e) {
            logger.error("é¢„è®¢çŠ¶æ€æµè½¬æµ‹è¯•å¤±è´¥", e);
        }
    }
}
```

---

## ğŸ”— é›†æˆæµ‹è¯•

### 1. é¢„è®¢å†²çªæ£€æµ‹æµ‹è¯•

```java
public class BookingConflictTest extends BaseTest {
    
    @Test
    public void testBookingConflictDetection() {
        // ç°æœ‰é¢„è®¢ï¼š2025-09-26 åˆ° 2025-09-28
        LocalDate existingCheckIn = LocalDate.of(2025, 9, 26);
        LocalDate existingCheckOut = LocalDate.of(2025, 9, 28);
        
        // æµ‹è¯•ç”¨ä¾‹ï¼š[æ–°å…¥ä½æ—¥æœŸ, æ–°é€€æˆ¿æ—¥æœŸ, æ˜¯å¦åº”è¯¥å†²çª, æè¿°]
        Object[][] testCases = {
            {LocalDate.of(2025, 9, 24), LocalDate.of(2025, 9, 26), false, "æ—©äºç°æœ‰é¢„è®¢"},
            {LocalDate.of(2025, 9, 28), LocalDate.of(2025, 9, 30), false, "æ™šäºç°æœ‰é¢„è®¢"},
            {LocalDate.of(2025, 9, 25), LocalDate.of(2025, 9, 27), true, "è·¨è¶Šå…¥ä½æ—¥æœŸ"},
            {LocalDate.of(2025, 9, 27), LocalDate.of(2025, 9, 29), true, "è·¨è¶Šé€€æˆ¿æ—¥æœŸ"},
            {LocalDate.of(2025, 9, 26), LocalDate.of(2025, 9, 28), true, "å®Œå…¨é‡å "}
        };
        
        for (Object[] testCase : testCases) {
            LocalDate newCheckIn = (LocalDate) testCase[0];
            LocalDate newCheckOut = (LocalDate) testCase[1];
            boolean expectedConflict = (Boolean) testCase[2];
            String description = (String) testCase[3];
            
            // ä½¿ç”¨SQLé€»è¾‘æ£€æŸ¥å†²çª
            boolean hasConflict = !(existingCheckOut.compareTo(newCheckIn) <= 0 || 
                                   existingCheckIn.compareTo(newCheckOut) >= 0);
            
            assertEquals("å†²çªæ£€æŸ¥ç»“æœåº”è¯¥æ­£ç¡®ï¼š" + description, expectedConflict, hasConflict);
        }
    }
}
```

### 2. Controllerå‚æ•°éªŒè¯æµ‹è¯•

```java
public class BookingControllerParameterTest extends BaseTest {
    
    @Test
    public void testParameterValidation() {
        // æµ‹è¯•å…¥ä½äººæ•°éªŒè¯
        String[] testValues = {"", "0", "-1", "1", "2", "abc", null};
        
        for (String value : testValues) {
            ParameterValidationResult result = validateGuestsCount(value);
            System.out.printf("æµ‹è¯•å€¼: '%s' -> %s%n", value, 
                result.isValid() ? "âœ… éªŒè¯é€šè¿‡" : "âŒ " + result.getErrorMessage());
        }
    }
    
    private ParameterValidationResult validateGuestsCount(String value) {
        if (Utils.isEmpty(value)) {
            return new ParameterValidationResult(false, "å…¥ä½äººæ•°ä¸èƒ½ä¸ºç©º");
        }
        
        try {
            int guestsCount = Integer.parseInt(value.trim());
            if (guestsCount <= 0) {
                return new ParameterValidationResult(false, "å…¥ä½äººæ•°å¿…é¡»ä¸ºæ­£æ•°");
            }
            return new ParameterValidationResult(true, null);
        } catch (NumberFormatException e) {
            return new ParameterValidationResult(false, "å…¥ä½äººæ•°æ ¼å¼ä¸æ­£ç¡®");
        }
    }
    
    private static class ParameterValidationResult {
        private final boolean valid;
        private final String errorMessage;
        
        public ParameterValidationResult(boolean valid, String errorMessage) {
            this.valid = valid;
            this.errorMessage = errorMessage;
        }
        
        public boolean isValid() { return valid; }
        public String getErrorMessage() { return errorMessage; }
    }
}
```

---

## âš¡ æ€§èƒ½æµ‹è¯•

### å¹¶å‘é¢„è®¢æµ‹è¯•

```java
public class BookingPerformanceTest extends BaseTest {
    
    @Test
    public void testConcurrentBookingCreation() {
        int threadCount = 20;
        int bookingsPerThread = 10;
        CountDownLatch startLatch = new CountDownLatch(1);
        CountDownLatch completeLatch = new CountDownLatch(threadCount);
        AtomicInteger successCount = new AtomicInteger(0);
        AtomicInteger failureCount = new AtomicInteger(0);
        
        ExecutorService executor = Executors.newFixedThreadPool(threadCount);
        
        for (int i = 0; i < threadCount; i++) {
            final int threadId = i;
            executor.submit(() -> {
                try {
                    startLatch.await();
                    
                    for (int j = 0; j < bookingsPerThread; j++) {
                        try {
                            Booking booking = createTestBooking(threadId, j);
                            Integer bookingId = bookingService.createBooking(booking);
                            
                            if (bookingId != null) {
                                successCount.incrementAndGet();
                                bookingService.deleteBooking(bookingId);
                            } else {
                                failureCount.incrementAndGet();
                            }
                        } catch (Exception e) {
                            failureCount.incrementAndGet();
                        }
                    }
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } finally {
                    completeLatch.countDown();
                }
            });
        }
        
        long startTime = System.currentTimeMillis();
        startLatch.countDown();
        
        try {
            completeLatch.await(60, TimeUnit.SECONDS);
            long duration = System.currentTimeMillis() - startTime;
            
            int totalOperations = threadCount * bookingsPerThread;
            double tps = (double) totalOperations / (duration / 1000.0);
            
            System.out.println("å¹¶å‘æµ‹è¯•ç»“æœ:");
            System.out.println("- æ€»æ“ä½œæ•°: " + totalOperations);
            System.out.println("- æˆåŠŸæ•°: " + successCount.get());
            System.out.println("- å¤±è´¥æ•°: " + failureCount.get());
            System.out.println("- TPS: " + String.format("%.2f", tps));
            
            assertTrue("æˆåŠŸç‡åº”è¯¥å¤§äº80%", 
                      (double) successCount.get() / totalOperations > 0.8);
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            executor.shutdown();
        }
    }
}
```

---

## ğŸ› ï¸ æµ‹è¯•å·¥å…·

### æŠ€æœ¯æ ˆ

```mermaid
graph TB
    subgraph "æµ‹è¯•æ¡†æ¶"
        JUnit[JUnit 4]
        Mockito[Mockito]
    end
    
    subgraph "æ„å»ºå·¥å…·"
        Maven[Maven Surefire]
        JaCoCo[ä»£ç è¦†ç›–ç‡]
    end
    
    subgraph "æ€§èƒ½æµ‹è¯•"
        JMeter[JMeter]
        Concurrent[å¹¶å‘æµ‹è¯•]
    end
    
    JUnit --> Maven
    Mockito --> JUnit
    Maven --> JaCoCo
    JMeter --> Concurrent
```

### Mavené…ç½®

```xml
<dependencies>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.13.2</version>
        <scope>test</scope>
    </dependency>
    
    <dependency>
        <groupId>org.mockito</groupId>
        <artifactId>mockito-core</artifactId>
        <version>3.12.4</version>
        <scope>test</scope>
    </dependency>
</dependencies>

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>3.0.0-M7</version>
            <configuration>
                <includes>
                    <include>**/*Test.java</include>
                </includes>
            </configuration>
        </plugin>
        
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.7</version>
            <executions>
                <execution>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
                <execution>
                    <id>report</id>
                    <phase>test</phase>
                    <goals>
                        <goal>report</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

### æµ‹è¯•æ‰§è¡Œå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=BookingServiceTest

# ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š
mvn clean test jacoco:report

# è¿è¡Œæ€§èƒ½æµ‹è¯•
mvn test -Dtest=*PerformanceTest
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### è¦†ç›–ç‡ç›®æ ‡
- **ä»£ç è¡Œè¦†ç›–ç‡**: â‰¥ 80%
- **åˆ†æ”¯è¦†ç›–ç‡**: â‰¥ 70%
- **æ–¹æ³•è¦†ç›–ç‡**: â‰¥ 85%

### å…³é”®æµ‹è¯•åœºæ™¯
1. **æ­£å¸¸ä¸šåŠ¡æµç¨‹**: é¢„è®¢åˆ›å»ºã€ç¡®è®¤ã€å…¥ä½ã€é€€æˆ¿
2. **å¼‚å¸¸å¤„ç†**: å‚æ•°éªŒè¯ã€æ•°æ®åº“å¼‚å¸¸ã€ä¸šåŠ¡è§„åˆ™è¿å
3. **è¾¹ç•Œæ¡ä»¶**: ç©ºå€¼å¤„ç†ã€æ•°æ®èŒƒå›´éªŒè¯ã€å¹¶å‘å†²çª
4. **å®‰å…¨æµ‹è¯•**: æƒé™éªŒè¯ã€è¾“å…¥è¿‡æ»¤ã€SQLæ³¨å…¥é˜²æŠ¤
5. **æ€§èƒ½æµ‹è¯•**: å¹¶å‘å¤„ç†ã€å“åº”æ—¶é—´ã€èµ„æºä½¿ç”¨

---

## ğŸ”š æ€»ç»“

æœ¬é…’åº—ç®¡ç†ç³»ç»Ÿçš„æµ‹è¯•ä½“ç³»ç¡®ä¿äº†ï¼š

### æµ‹è¯•å®Œæ•´æ€§
- **å•å…ƒæµ‹è¯•**ï¼šè¦†ç›–æ‰€æœ‰å·¥å…·ç±»å’Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **é›†æˆæµ‹è¯•**ï¼šéªŒè¯ç»„ä»¶é—´çš„åä½œå’Œæ•°æ®ä¸€è‡´æ€§
- **æ€§èƒ½æµ‹è¯•**ï¼šä¿è¯ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„ç¨³å®šæ€§

### è´¨é‡ä¿éšœ
- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šé€šè¿‡Mavenæ„å»ºé›†æˆï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½æ‰§è¡Œæµ‹è¯•
- **ä»£ç è¦†ç›–ç‡**ï¼šé€šè¿‡JaCoCoç›‘æ§æµ‹è¯•è¦†ç›–ç‡ï¼Œç¡®ä¿æµ‹è¯•å……åˆ†æ€§
- **æŒç»­é›†æˆ**ï¼šæµ‹è¯•ç»“æœåŠæ—¶åé¦ˆï¼Œå¿«é€Ÿå‘ç°å’Œä¿®å¤é—®é¢˜

### æœ€ä½³å®è·µ
- **æµ‹è¯•ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæµ‹è¯•éƒ½èƒ½ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- **æµ‹è¯•å¯é‡å¤æ€§**ï¼šç›¸åŒçš„æµ‹è¯•åœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½å¾—åˆ°ä¸€è‡´ç»“æœ
- **æµ‹è¯•å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æµ‹è¯•ç»“æ„å’Œå‘½åï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤

é€šè¿‡å…¨é¢çš„æµ‹è¯•ç­–ç•¥ï¼Œç³»ç»Ÿåœ¨åŠŸèƒ½æ­£ç¡®æ€§ã€ç¨³å®šæ€§å’Œæ€§èƒ½æ–¹é¢éƒ½å¾—åˆ°äº†æœ‰æ•ˆä¿éšœã€‚